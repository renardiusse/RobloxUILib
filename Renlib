--[[
    Modern Roblox UI Library (Xeno/Eclipse Style)
    Author: Antigravity
    License: MIT
]]

local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local LocalPlayer = game:GetService("Players").LocalPlayer
local Mouse = LocalPlayer:GetMouse()
local HttpService = game:GetService("HttpService")
local CoreGui = game:GetService("CoreGui")

local Library = {
    Connections = {},
    Flags = {},
    Unloaded = false,
    Theme = {
        Background = Color3.fromRGB(15, 15, 20),
        Sidebar = Color3.fromRGB(20, 20, 25),
        SectionBackground = Color3.fromRGB(25, 25, 30),
        ElementBackground = Color3.fromRGB(35, 35, 40),
        Accent = Color3.fromRGB(114, 137, 218), -- Blurple-ish default, can be changed
        Text = Color3.fromRGB(255, 255, 255),
        SubText = Color3.fromRGB(170, 170, 170),
        Outline = Color3.fromRGB(45, 45, 50),
        Font = Enum.Font.GothamMedium,
        BoldFont = Enum.Font.GothamBold
    },
    GuiInstance = nil
}

-- Utility Functions
function Library:Create(class, properties)
    local instance = Instance.new(class)
    for k, v in pairs(properties) do
        instance[k] = v
    end
    return instance
end

function Library:Tween(instance, info, properties)
    local tween = TweenService:Create(instance, info, properties)
    tween:Play()
    return tween
end

function Library:SafeCallback(callback, ...)
    if callback and type(callback) == "function" then
        local success, err = pcall(callback, ...)
        if not success then
            warn("[UI Library] Callback Error: " .. tostring(err))
        end
    end
end

-- Dragging Functionality
function Library:MakeDraggable(topbar, object)
    local dragging, dragInput, dragStart, startPos

    local function update(input)
        local delta = input.Position - dragStart
        local newPos = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        -- Add smooth transition
        TweenService:Create(object, TweenInfo.new(0.05), {Position = newPos}):Play()
    end

    topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = object.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    topbar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            update(input)
        end
    end)
end

-- Main Window Function
function Library:CreateWindow(options)
    options = options or {}
    local Name = options.Name or "UI Library"
    local ToggleKey = options.ToggleKey or Enum.KeyCode.RightShift
    
    -- Destroy old instance if exists
    if Library.GuiInstance then
        Library.GuiInstance:Destroy()
    end

    -- Main ScreenGui
    local ScreenGui = self:Create("ScreenGui", {
        Name = "ModernUI_Xeno",
        ResetOnSpawn = false,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    })

    -- Safe Parenting
    local parentSuccess, _ = pcall(function()
        ScreenGui.Parent = CoreGui
    end)
    
    if not parentSuccess then
        ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    end
    
    -- Protect GUI (if supported)
    if syn and syn.protect_gui then
        syn.protect_gui(ScreenGui)
    end
    
    Library.GuiInstance = ScreenGui

    -- Main Frame (Window)
    local MainFrame = self:Create("Frame", {
        Name = "MainFrame",
        Parent = ScreenGui,
        BackgroundColor3 = self.Theme.Background,
        BorderSizePixel = 0,
        Position = UDim2.new(0.5, -350, 0.5, -225),
        Size = UDim2.new(0, 700, 0, 450),
        ClipsDescendants = true
    })
    
    self:Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = MainFrame})
    self:Create("UIStroke", {Parent = MainFrame, Color = self.Theme.Outline, Thickness = 1})

    -- Global Toggle Keybind
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if not gameProcessed and input.KeyCode == ToggleKey then
            MainFrame.Visible = not MainFrame.Visible
        end
    end)

    -- Topbar (Height 45)
    local Topbar = self:Create("Frame", {
        Name = "Topbar",
        Parent = MainFrame,
        BackgroundColor3 = self.Theme.Sidebar,
        BorderSizePixel = 0,
        Size = UDim2.new(1, 0, 0, 45),
        ZIndex = 10
    })
    
    self:Create("UICorner", {CornerRadius = UDim.new(0, 10), Parent = Topbar}) -- Top corners only effectively
    -- Fix bottom corners of topbar
    local TopbarFiller = self:Create("Frame", {
        Parent = Topbar,
        BackgroundColor3 = self.Theme.Sidebar,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 1, -10),
        Size = UDim2.new(1, 0, 0, 10)
    })

    local Title = self:Create("TextLabel", {
        Name = "Title",
        Parent = Topbar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 60, 0, 0),
        Size = UDim2.new(0.5, 0, 1, 0),
        Font = self.Theme.BoldFont,
        Text = Name,
        TextColor3 = self.Theme.Text,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Logo Placeholder (Icon)
    local Logo = self:Create("ImageLabel", {
        Name = "Logo",
        Parent = Topbar,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 15, 0, 7),
        Size = UDim2.new(0, 30, 0, 30),
        Image = "rbxassetid://13350795511", -- Abstract shape icon
        ImageColor3 = self.Theme.Accent
    })

    -- Window Controls
    local ControlsHolder = self:Create("Frame", {
        Parent = Topbar,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -90, 0, 0),
        Size = UDim2.new(0, 90, 1, 0)
    })
    
    local CloseButton = self:Create("TextButton", {
        Name = "Close",
        Parent = ControlsHolder,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -40, 0, 0),
        Size = UDim2.new(0, 40, 1, 0),
        Font = self.Theme.Font,
        Text = "Ã—",
        TextColor3 = self.Theme.SubText,
        TextSize = 24
    })
    
    CloseButton.MouseButton1Click:Connect(function()
        ScreenGui:Destroy()
        Library.Unloaded = true
    end)
    
    local MinimizeButton = self:Create("TextButton", {
        Name = "Minimize",
        Parent = ControlsHolder,
        BackgroundTransparency = 1,
        Position = UDim2.new(1, -80, 0, 0),
        Size = UDim2.new(0, 40, 1, 0),
        Font = self.Theme.Font,
        Text = "-",
        TextColor3 = self.Theme.SubText,
        TextSize = 24
    })
    
    local Minimized = false
    MinimizeButton.MouseButton1Click:Connect(function()
        Minimized = not Minimized
        if Minimized then
             Library:Tween(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0, 700, 0, 45)})
        else
             Library:Tween(MainFrame, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(0, 700, 0, 450)})
        end
    end)
    
    self:MakeDraggable(Topbar, MainFrame)

    -- Sidebar (Tabs)
    local Sidebar = self:Create("ScrollingFrame", {
        Name = "Sidebar",
        Parent = MainFrame,
        BackgroundColor3 = self.Theme.Sidebar,
        BorderSizePixel = 0,
        Position = UDim2.new(0, 0, 0, 45),
        Size = UDim2.new(0, 60, 1, -45), -- Expanded on hover? Or just icons? Let's do icon + text
        ScrollBarThickness = 0,
        ClipsDescendants = false
    })
    
    -- Sidebar styling (full height on left)
    -- Actually, if we look at Xeno, sidebar is usually left.
    Sidebar.Size = UDim2.new(0, 180, 1, -45)
    
    local SidebarLayout = self:Create("UIListLayout", {
        Parent = Sidebar,
        Padding = UDim.new(0, 5),
        SortOrder = Enum.SortOrder.LayoutOrder,
        HorizontalAlignment = Enum.HorizontalAlignment.Center
    })
    
    self:Create("UIPadding", {Parent = Sidebar, PaddingTop = UDim.new(0, 10)})

    -- Page Container
    local PageContainer = self:Create("Frame", {
        Name = "Pages",
        Parent = MainFrame,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 190, 0, 55),
        Size = UDim2.new(1, -200, 1, -65),
        ClipsDescendants = true
    })

    -- Window Object
    local Window = {
        Tabs = {},
        CurrentTab = nil
    }

    function Window:CreateTab(name, iconId)
        iconId = iconId or "rbxassetid://4483345998" -- Generic folder/tab icon
        
        local Tab = {
            Name = name,
            Sections = {}
        }
        
        -- Tab Button
        local TabButton = Library:Create("TextButton", {
            Name = name .. "Tab",
            Parent = Sidebar,
            BackgroundColor3 = Library.Theme.Sidebar,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, -20, 0, 36), -- Sidebar width - padding
            AutoButtonColor = false,
            Text = ""
        })
        
        Library:Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = TabButton})
        
        local TabTitle = Library:Create("TextLabel", {
            Parent = TabButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 35, 0, 0),
            Size = UDim2.new(1, -35, 1, 0),
            Font = Library.Theme.Font,
            Text = name,
            TextColor3 = Library.Theme.SubText,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local TabIcon = Library:Create("ImageLabel", {
            Parent = TabButton,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 8, 0.5, -9),
            Size = UDim2.new(0, 18, 0, 18),
            Image = iconId,
            ImageColor3 = Library.Theme.SubText
        })
        
        -- State Indicator (Selected line)
        local SelectedIndicator = Library:Create("Frame", {
            Parent = TabButton,
            BackgroundColor3 = Library.Theme.Accent,
            Position = UDim2.new(0, 0, 0.2, 0),
            Size = UDim2.new(0, 3, 0.6, 0),
            Transparency = 1
        })
         Library:Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = SelectedIndicator})

        
        -- Page
        local TabPage = Library:Create("ScrollingFrame", {
            Name = name .. "Page",
            Parent = PageContainer,
            BackgroundTransparency = 1,
            Size = UDim2.new(1, 0, 1, 0),
            ScrollBarThickness = 2,
            CanvasSize = UDim2.new(0, 0, 0, 0),
            Visible = false
        })
        
        Library:Create("UIListLayout", {
            Parent = TabPage,
            Padding = UDim.new(0, 10),
            SortOrder = Enum.SortOrder.LayoutOrder
        })
        
         Library:Create("UIPadding", {
            Parent = TabPage,
            PaddingBottom = UDim.new(0, 10)
        })

        -- Activate Logic
        function Tab:Activate()
             for _, t in pairs(Window.Tabs) do
                -- Deactivate others
                Library:Tween(t.Button.ImageLabel, TweenInfo.new(0.2), {ImageColor3 = Library.Theme.SubText})
                Library:Tween(t.Button.TextLabel, TweenInfo.new(0.2), {TextColor3 = Library.Theme.SubText})
                Library:Tween(t.Button, TweenInfo.new(0.2), {BackgroundTransparency = 1})
                Library:Tween(t.Indicator, TweenInfo.new(0.2), {Transparency = 1})
                t.Page.Visible = false
            end
            
            -- Activate this
            Library:Tween(TabButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.95, BackgroundColor3 = Library.Theme.Accent})
            Library:Tween(TabTitle, TweenInfo.new(0.2), {TextColor3 = Library.Theme.Text})
            Library:Tween(TabIcon, TweenInfo.new(0.2), {ImageColor3 = Library.Theme.Text})
             Library:Tween(SelectedIndicator, TweenInfo.new(0.2), {Transparency = 0})
            TabPage.Visible = true
            Window.CurrentTab = Tab
        end
        
        TabButton.MouseButton1Click:Connect(function() Tab:Activate() end)
        
        Tab.Button = TabButton
        Tab.Indicator = SelectedIndicator
        Tab.Page = TabPage
        table.insert(Window.Tabs, Tab)
        
        if #Window.Tabs == 1 then Tab:Activate() end
        
        -- SECTION -------------------------------------------------------------
        function Tab:CreateSection(secName)
            local Section = {}
            
            local SectionContainer = Library:Create("Frame", {
                Name = secName .. "Section",
                Parent = TabPage,
                BackgroundColor3 = Library.Theme.SectionBackground,
                Size = UDim2.new(1, -10, 0, 100), -- Auto
                ClipsDescendants = true
            })
            
            Library:Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = SectionContainer})
            Library:Create("UIStroke", {Parent = SectionContainer, Color = Library.Theme.Outline, Thickness = 1})
            
            local SectionTitle = Library:Create("TextLabel", {
                 Parent = SectionContainer,
                 BackgroundTransparency = 1,
                 Position = UDim2.new(0, 12, 0, 8),
                 Size = UDim2.new(1, -24, 0, 20),
                 Font = Library.Theme.BoldFont,
                 Text = secName,
                 TextColor3 = Library.Theme.Text,
                 TextSize = 14,
                 TextXAlignment = Enum.TextXAlignment.Left
            })
            
            local ContentHolder = Library:Create("Frame", {
                 Parent = SectionContainer,
                 BackgroundTransparency = 1,
                 Position = UDim2.new(0, 12, 0, 35),
                 Size = UDim2.new(1, -24, 0, 0)
            })
            
            local ContentLayout = Library:Create("UIListLayout", {
                Parent = ContentHolder,
                Padding = UDim.new(0, 8),
                SortOrder = Enum.SortOrder.LayoutOrder
            })
            
            -- Auto Resize
            ContentLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
                ContentHolder.Size = UDim2.new(1, -24, 0, ContentLayout.AbsoluteContentSize.Y)
                SectionContainer.Size = UDim2.new(1, -10, 0, ContentLayout.AbsoluteContentSize.Y + 45)
                
                -- Resize TabPage Canvas
                 local totalSize = 0
                for _, child in pairs(TabPage:GetChildren()) do
                    if child:IsA("Frame") then
                        totalSize = totalSize + child.AbsoluteSize.Y + 10 -- Padding
                    end
                end
                TabPage.CanvasSize = UDim2.new(0, 0, 0, totalSize + 20)
            end)
            
            -- ELEMENTS --------------------------------------------------------
            
             function Section:CreateButton(btnName, callback)
                callback = callback or function() end
                
                local Button = Library:Create("TextButton", {
                    Name = btnName .. "Button",
                    Parent = ContentHolder,
                    BackgroundColor3 = Library.Theme.ElementBackground,
                    Size = UDim2.new(1, 0, 0, 32),
                    AutoButtonColor = false,
                    Text = ""
                })
                
                Library:Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Button})
                Library:Create("UIStroke", {Parent = Button, Color = Library.Theme.Outline, Thickness = 1})
                
                local Title = Library:Create("TextLabel", {
                    Parent = Button,
                    BackgroundTransparency = 1,
                    Size = UDim2.new(1, 0, 1, 0),
                    Font = Library.Theme.Font,
                    Text = btnName,
                    TextColor3 = Library.Theme.Text,
                    TextSize = 13
                })
                
                Button.MouseEnter:Connect(function()
                     Library:Tween(Button, TweenInfo.new(0.2), {BackgroundColor3 = Library.Theme.Accent})
                end)
                 Button.MouseLeave:Connect(function()
                     Library:Tween(Button, TweenInfo.new(0.2), {BackgroundColor3 = Library.Theme.ElementBackground})
                end)
                Button.MouseButton1Click:Connect(function()
                    Library:SafeCallback(callback)
                end)
            end
            
            function Section:CreateToggle(name, default, callback)
                default = default or false
                callback = callback or function() end
                local toggled = default
                
                local Container = Library:Create("TextButton", {
                    Name = name .. "Toggle",
                    Parent = ContentHolder,
                    BackgroundColor3 = Library.Theme.ElementBackground,
                    Size = UDim2.new(1, 0, 0, 32),
                    AutoButtonColor = false,
                    Text = ""
                })
                 Library:Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Container})
                 
               local Title = Library:Create("TextLabel", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 10, 0, 0),
                    Size = UDim2.new(0.7, 0, 1, 0),
                    Font = Library.Theme.Font,
                    Text = name,
                    TextColor3 = Library.Theme.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                
                local Switch = Library:Create("Frame", {
                    Parent = Container,
                    BackgroundColor3 = toggled and Library.Theme.Accent or Color3.fromRGB(60, 60, 60),
                    Position = UDim2.new(1, -45, 0.5, -10),
                    Size = UDim2.new(0, 35, 0, 20)
                })
                 Library:Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = Switch})
                 
                local Dot = Library:Create("Frame", {
                    Parent = Switch,
                    BackgroundColor3 = Color3.fromRGB(255, 255, 255),
                    Position = toggled and UDim2.new(1, -18, 0.5, -8) or UDim2.new(0, 2, 0.5, -8),
                    Size = UDim2.new(0, 16, 0, 16)
                })
                Library:Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = Dot})
                
                 Container.MouseButton1Click:Connect(function()
                    toggled = not toggled
                    Library:SafeCallback(callback, toggled)
                    
                    if toggled then
                        Library:Tween(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Library.Theme.Accent})
                        Library:Tween(Dot, TweenInfo.new(0.2), {Position = UDim2.new(1, -18, 0.5, -8)})
                    else
                        Library:Tween(Switch, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(60, 60, 60)})
                        Library:Tween(Dot, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -8)})
                    end
                end)
            end
            
             function Section:CreateSlider(name, options, callback)
                local min = options.Min or 0
                local max = options.Max or 100
                local default = options.Default or min
                callback = callback or function() end
                
                local Container = Library:Create("Frame", {
                    Name = name .. "Slider",
                    Parent = ContentHolder,
                    BackgroundColor3 = Library.Theme.ElementBackground,
                    Size = UDim2.new(1, 0, 0, 45)
                })
                 Library:Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Container})
                 
                 local Title = Library:Create("TextLabel", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 10, 0, 5),
                    Size = UDim2.new(0.7, 0, 0, 20),
                    Font = Library.Theme.Font,
                    Text = name,
                    TextColor3 = Library.Theme.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                })
                 local ValueText = Library:Create("TextLabel", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(1, -60, 0, 5),
                    Size = UDim2.new(0, 50, 0, 20),
                    Font = Library.Theme.Font,
                    Text = tostring(default),
                    TextColor3 = Library.Theme.SubText,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Right
                })
                
                local SliderBg = Library:Create("TextButton", {
                    Parent = Container,
                    BackgroundColor3 = Color3.fromRGB(60, 60, 60),
                    Position = UDim2.new(0, 10, 0, 30),
                    Size = UDim2.new(1, -20, 0, 6),
                    AutoButtonColor = false,
                    Text = ""
                })
                 Library:Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = SliderBg})
                 
                  local Fill = Library:Create("Frame", {
                    Parent = SliderBg,
                    BackgroundColor3 = Library.Theme.Accent,
                    Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
                })
                Library:Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = Fill})
                
                -- Slider Logic logic similar to previous logic but updated styling
                local dragging = false
                local function update(input)
                    local sizeX = math.clamp((input.Position.X - SliderBg.AbsolutePosition.X) / SliderBg.AbsoluteSize.X, 0, 1)
                    local value = math.floor(min + ((max - min) * sizeX))
                    Library:Tween(Fill, TweenInfo.new(0.05), {Size = UDim2.new(sizeX, 0, 1, 0)})
                    ValueText.Text = tostring(value)
                    Library:SafeCallback(callback, value)
                end
                 SliderBg.InputBegan:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                        dragging = true
                        update(input)
                    end
                end)
                UserInputService.InputChanged:Connect(function(input)
                    if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then update(input) end
                end)
                UserInputService.InputEnded:Connect(function(input)
                    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = false end
                end)
            end
            
            -- Keybind and Dropdown would follow similar "Container" pattern...
             function Section:CreateKeybind(name, default, callback)
                 default = default or Enum.KeyCode.RightShift
                 callback = callback or function() end
                 
                 local Container = Library:Create("Frame", {
                     Parent = ContentHolder,
                     BackgroundColor3 = Library.Theme.ElementBackground,
                     Size = UDim2.new(1, 0, 0, 32)
                 })
                 Library:Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = Container})
                 
                 local Title = Library:Create("TextLabel", {
                    Parent = Container,
                    BackgroundTransparency = 1,
                    Position = UDim2.new(0, 10, 0, 0),
                    Size = UDim2.new(0.6, 0, 1, 0),
                    Font = Library.Theme.Font,
                    Text = name,
                    TextColor3 = Library.Theme.Text,
                    TextSize = 13,
                    TextXAlignment = Enum.TextXAlignment.Left
                 })
                 
                 local BindBtn = Library:Create("TextButton", {
                     Parent = Container,
                     BackgroundColor3 = Color3.fromRGB(60, 60, 60),
                     Position = UDim2.new(1, -90, 0.5, -10),
                     Size = UDim2.new(0, 80, 0, 20),
                     Font = Library.Theme.Font,
                     Text = default.Name,
                     TextColor3 = Library.Theme.SubText,
                     TextSize = 12,
                     AutoButtonColor = false
                 })
                 Library:Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = BindBtn})
                 
                 local listening = false
                 BindBtn.MouseButton1Click:Connect(function()
                     listening = true
                     BindBtn.Text = "..."
                     BindBtn.TextColor3 = Library.Theme.Accent
                 end)
                 
                 UserInputService.InputBegan:Connect(function(input)
                     if listening and input.UserInputType == Enum.UserInputType.Keyboard then
                         default = input.KeyCode
                         BindBtn.Text = default.Name
                         BindBtn.TextColor3 = Library.Theme.SubText
                         listening = false
                         Library:SafeCallback(callback, default)
                     elseif not listening and input.KeyCode == default then
                         Library:SafeCallback(callback)
                     end
                 end)
             end

            return Section
        end
        
        return Tab
    end
    

    function Library:Notify(options)
        options = options or {}
        local TitleVal = options.Title or "Notification"
        local ContentVal = options.Content or "Message"
        local Duration = options.Duration or 3
        
        -- Create container if not exists
        local NotifyGui = CoreGui:FindFirstChild("ModernUINotify") or LocalPlayer:WaitForChild("PlayerGui"):FindFirstChild("ModernUINotify")
        if not NotifyGui then
            NotifyGui = Library:Create("ScreenGui", {
                Name = "ModernUINotify",
                ResetOnSpawn = false
            })
            local success, _ = pcall(function() NotifyGui.Parent = CoreGui end)
            if not success then NotifyGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end
            if syn and syn.protect_gui then syn.protect_gui(NotifyGui) end
        end
        
        local Container = NotifyGui:FindFirstChild("Container")
        if not Container then
            Container = Library:Create("Frame", {
                Name = "Container",
                Parent = NotifyGui,
                BackgroundTransparency = 1,
                Position = UDim2.new(1, -320, 1, -20),
                Size = UDim2.new(0, 300, 1, 0),
                AnchorPoint = Vector2.new(0, 1)
            })
            Library:Create("UIListLayout", {
                Parent = Container,
                Padding = UDim.new(0, 8),
                SortOrder = Enum.SortOrder.LayoutOrder,
                VerticalAlignment = Enum.VerticalAlignment.Bottom
            })
        end
        
        local NotifyFrame = Library:Create("Frame", {
            Parent = Container,
            BackgroundColor3 = Library.Theme.SectionBackground,
            Size = UDim2.new(1, 0, 0, 0), -- Animate
            ClipsDescendants = true
        })
        Library:Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = NotifyFrame})
        Library:Create("UIStroke", {Parent = NotifyFrame, Color = Library.Theme.Outline, Thickness = 1})
        
        local SideBar = Library:Create("Frame", {
            Parent = NotifyFrame,
            BackgroundColor3 = Library.Theme.Accent,
            Size = UDim2.new(0, 4, 1, 0)
        })
        
        local Title = Library:Create("TextLabel", {
            Parent = NotifyFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 12, 0, 8),
            Size = UDim2.new(1, -20, 0, 20),
            Font = Library.Theme.BoldFont,
            Text = TitleVal,
            TextColor3 = Library.Theme.Text,
            TextSize = 14,
            TextXAlignment = Enum.TextXAlignment.Left
        })
        
        local Content = Library:Create("TextLabel", {
            Parent = NotifyFrame,
            BackgroundTransparency = 1,
            Position = UDim2.new(0, 12, 0, 28),
            Size = UDim2.new(1, -20, 0, 20),
            Font = Library.Theme.Font,
            Text = ContentVal,
            TextColor3 = Library.Theme.SubText,
            TextSize = 13,
            TextXAlignment = Enum.TextXAlignment.Left,
            TextWrapped = true
        })
        
        -- Animation
        Library:Tween(NotifyFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 60)})
        
        task.delay(Duration, function()
             local t = Library:Tween(NotifyFrame, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 0)})
             t.Completed:Wait()
             NotifyFrame:Destroy()
        end)
    end
    
    return Window
end

return Library
